{"name":"Energy VD V.1.00","type":"virtual_device","properties":{"deviceIcon":0,"currentIcon":"0","log":"","logTemp":"","mainLoop":"-- Main Part\nvirtualId = fibaro:getSelfId();\n\n-- Initial from empty\nif fibaro:get(virtualId,\"ui.fromtime.value\") == \"\" then\n  fibaro:call(virtualId, \"setProperty\", \"ui.fromtime.value\", os.date(\"%y/%m/%d\"));\nend\nif fibaro:get(virtualId,\"ui.totime.value\") == \"\" then\n  fibaro:call(virtualId, \"setProperty\", \"ui.totime.value\", os.date(\"%y/%m/%d\"));\nend\n\n-- Convert\nlocal fromtime = fibaro:get(virtualId,\"ui.fromtime.value\");\nlocal Y = string.sub(fromtime, 1,2);\nlocal M = string.sub(fromtime, 4,5);\nlocal D = string.sub(fromtime, 7,8);\nY = tonumber(Y)+2000;\nlocal dt = {year=Y, month=tonumber(M), day=tonumber(D), hour=0, min=0, sec=0}\nfibaro:call(virtualId, \"setProperty\", \"ui.fromts.value\", os.time(dt));\n\nlocal totime = fibaro:get(virtualId,\"ui.totime.value\");\nlocal Y = string.sub(totime, 1,2);\nlocal M = string.sub(totime, 4,5);\nlocal D = string.sub(totime, 7,8);\nY = tonumber(Y)+2000;\nlocal dt = {year=Y, month=tonumber(M), day=tonumber(D), hour=0, min=0, sec=0}\nfibaro:call(virtualId, \"setProperty\", \"ui.tots.value\", os.time(dt));\n\nfibaroconnect = Net.FHttp('127.0.0.1', 11111);\nfibaroconnect:setBasicAuthentication('admin', 'admin');\nlocal fromT = fibaro:get(virtualId,\"ui.fromts.value\");\nlocal toT = fibaro:get(virtualId,\"ui.tots.value\");\nif tonumber(fromT) >= tonumber(toT) then fromT = tonumber(toT) - 1; end\nlocal response ,status, err = fibaroconnect:GET(\"/api/energy/\" .. fromT .. \"/\" .. toT .. \"/compare/devices/power/337\");\nlocal jsonTable = json.decode(response);\nfibaro:debug(status);\nfibaro:debug(jsonTable[1].kWh);\nfibaro:call(virtualId, \"setProperty\", \"ui.energy.value\", jsonTable[1].kWh .. \" kWh(Unit)\");\n","ui.energy.value":"595.74 kWh(Unit)","ui.fromtime.value":"20/08/01","ui.fromts.value":"1596214800","ui.totime.value":"20/08/31","ui.tots.value":"1598806800","visible":"true","rows":[{"type":"label","elements":[{"id":1,"lua":false,"waitForResponse":false,"caption":"Energy","name":"energy","favourite":false,"main":false}]},{"type":"label","elements":[{"id":2,"lua":false,"waitForResponse":false,"caption":"From","name":"fromtime","favourite":false,"main":false}]},{"type":"label","elements":[{"id":3,"lua":false,"waitForResponse":false,"caption":"UnixFrom","name":"fromts","favourite":false,"main":false}]},{"type":"button","elements":[{"id":4,"lua":true,"waitForResponse":false,"caption":"Y+","name":"Button11","empty":false,"msg":"virtualId = fibaro:getSelfId();\nfromtime = fibaro:get(virtualId,\"ui.fromtime.value\");\n\nlocal Y = string.sub(fromtime, 1,2);\nlocal M = string.sub(fromtime, 4,5);\nlocal D = string.sub(fromtime, 7,8);\n\nif tonumber(Y) == 99 then\n  Y = 0;\nelse\n  Y = tonumber(Y) + 1;\nend\n\nif string.len(Y) < 2 then Y = string.format(\"%s%s\", '0', Y); end\n\nfromtime = string.format(\"%s/%s/%s\", Y, M, D);\n\nfibaro:call(virtualId,\"setProperty\",\"ui.fromtime.value\", fromtime);","buttonIcon":0,"favourite":false,"main":false},{"id":5,"lua":true,"waitForResponse":false,"caption":"M+","name":"Button12","empty":false,"msg":"virtualId = fibaro:getSelfId();\nfromtime = fibaro:get(virtualId,\"ui.fromtime.value\");\n\nlocal Y = string.sub(fromtime, 1,2);\nlocal M = string.sub(fromtime, 4,5);\nlocal D = string.sub(fromtime, 7,8);\n\nif tonumber(M) == 12 then\n  M = 1;\nelse\n  M = tonumber(M) + 1;\nend\n\nif string.len(M) < 2 then M = string.format(\"%s%s\", '0', M); end\n\nfromtime = string.format(\"%s/%s/%s\", Y, M, D);\n\nfibaro:call(virtualId,\"setProperty\",\"ui.fromtime.value\", fromtime);","buttonIcon":0,"favourite":false,"main":false},{"id":6,"lua":true,"waitForResponse":false,"caption":"D+","name":"Button13","empty":false,"msg":"virtualId = fibaro:getSelfId();\nfromtime = fibaro:get(virtualId,\"ui.fromtime.value\");\n\nlocal Y = string.sub(fromtime, 1,2);\nlocal M = string.sub(fromtime, 4,5);\nlocal D = string.sub(fromtime, 7,8);\n\nlocal maxd = { 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 }\nif Y%4 == 0 then maxd[2] = 29; end\n\nif tonumber(D) == maxd[tonumber(M)] then\n  D = 1;\nelse\n  D = tonumber(D) + 1;\nend\n\n\nif string.len(D) < 2 then D = string.format(\"%s%s\", '0', D); end\n\nfromtime = string.format(\"%s/%s/%s\", Y, M, D);\n\nfibaro:call(virtualId,\"setProperty\",\"ui.fromtime.value\", fromtime);","buttonIcon":0,"favourite":false,"main":false}]},{"type":"button","elements":[{"id":7,"lua":true,"waitForResponse":false,"caption":"Y-","name":"Button21","empty":false,"msg":"virtualId = fibaro:getSelfId();\nfromtime = fibaro:get(virtualId,\"ui.fromtime.value\");\n\nlocal Y = string.sub(fromtime, 1,2);\nlocal M = string.sub(fromtime, 4,5);\nlocal D = string.sub(fromtime, 7,8);\n\nif tonumber(Y) == 0 then\n  Y = 99;\nelse\n  Y = tonumber(Y) - 1;\nend\n\nif string.len(Y) < 2 then Y = string.format(\"%s%s\", '0', Y); end\n\nfromtime = string.format(\"%s/%s/%s\", Y, M, D);\n\nfibaro:call(virtualId,\"setProperty\",\"ui.fromtime.value\", fromtime);","buttonIcon":0,"favourite":false,"main":false},{"id":8,"lua":true,"waitForResponse":false,"caption":"M-","name":"Button22","empty":false,"msg":"virtualId = fibaro:getSelfId();\nfromtime = fibaro:get(virtualId,\"ui.fromtime.value\");\n\nlocal Y = string.sub(fromtime, 1,2);\nlocal M = string.sub(fromtime, 4,5);\nlocal D = string.sub(fromtime, 7,8);\n\nif tonumber(M) == 1 then\n  M = 12\nelse\n  M = tonumber(M) - 1;\nend\n\nif string.len(M) < 2 then M = string.format(\"%s%s\", '0', M); end\n\nfromtime = string.format(\"%s/%s/%s\", Y, M, D);\n\nfibaro:call(virtualId,\"setProperty\",\"ui.fromtime.value\", fromtime);","buttonIcon":0,"favourite":false,"main":false},{"id":9,"lua":true,"waitForResponse":false,"caption":"D-","name":"Button23","empty":false,"msg":"virtualId = fibaro:getSelfId();\nfromtime = fibaro:get(virtualId,\"ui.fromtime.value\");\n\nlocal Y = string.sub(fromtime, 1,2);\nlocal M = string.sub(fromtime, 4,5);\nlocal D = string.sub(fromtime, 7,8);\n\nlocal maxd = { 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 }\nif Y%4 == 0 then maxd[2] = 29; end\n\nif tonumber(D) == 1 then\n  D = maxd[tonumber(M)]\nelse\n  D = tonumber(D) - 1;\nend\n\n\nif string.len(D) < 2 then D = string.format(\"%s%s\", '0', D); end\n\nfromtime = string.format(\"%s/%s/%s\", Y, M, D);\n\nfibaro:call(virtualId,\"setProperty\",\"ui.fromtime.value\", fromtime);","buttonIcon":0,"favourite":false,"main":false}]},{"type":"label","elements":[{"id":10,"lua":false,"waitForResponse":false,"caption":"To","name":"totime","favourite":false,"main":false}]},{"type":"label","elements":[{"id":11,"lua":false,"waitForResponse":false,"caption":"UnixTo","name":"tots","favourite":false,"main":false}]},{"type":"button","elements":[{"id":12,"lua":true,"waitForResponse":false,"caption":"Y+","name":"Button31","empty":false,"msg":"virtualId = fibaro:getSelfId();\ntotime = fibaro:get(virtualId,\"ui.totime.value\");\n\nlocal Y = string.sub(totime, 1,2);\nlocal M = string.sub(totime, 4,5);\nlocal D = string.sub(totime, 7,8);\n\nif tonumber(Y) == 99 then\n  Y = 0;\nelse\n  Y = tonumber(Y) + 1;\nend\n\nif string.len(Y) < 2 then Y = string.format(\"%s%s\", '0', Y); end\n\ntotime = string.format(\"%s/%s/%s\", Y, M, D);\n\nfibaro:call(virtualId,\"setProperty\",\"ui.totime.value\", totime);","buttonIcon":0,"favourite":false,"main":false},{"id":13,"lua":true,"waitForResponse":false,"caption":"M+","name":"Button32","empty":false,"msg":"virtualId = fibaro:getSelfId();\ntotime = fibaro:get(virtualId,\"ui.totime.value\");\n\nlocal Y = string.sub(totime, 1,2);\nlocal M = string.sub(totime, 4,5);\nlocal D = string.sub(totime, 7,8);\n\nif tonumber(M) == 12 then\n  M = 1;\nelse\n  M = tonumber(M) + 1;\nend\n\nif string.len(M) < 2 then M = string.format(\"%s%s\", '0', M); end\n\ntotime = string.format(\"%s/%s/%s\", Y, M, D);\n\nfibaro:call(virtualId,\"setProperty\",\"ui.totime.value\", totime);","buttonIcon":0,"favourite":false,"main":false},{"id":14,"lua":true,"waitForResponse":false,"caption":"D+","name":"Button33","empty":false,"msg":"virtualId = fibaro:getSelfId();\ntotime = fibaro:get(virtualId,\"ui.totime.value\");\n\nlocal Y = string.sub(totime, 1,2);\nlocal M = string.sub(totime, 4,5);\nlocal D = string.sub(totime, 7,8);\n\nlocal maxd = { 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 }\nif Y%4 == 0 then maxd[2] = 29; end\n\nif tonumber(D) == maxd[tonumber(M)] then\n  D = 1;\nelse\n  D = tonumber(D) + 1;\nend\n\n\nif string.len(D) < 2 then D = string.format(\"%s%s\", '0', D); end\n\ntotime = string.format(\"%s/%s/%s\", Y, M, D);\n\nfibaro:call(virtualId,\"setProperty\",\"ui.totime.value\", totime);","buttonIcon":0,"favourite":false,"main":false}]},{"type":"button","elements":[{"id":15,"lua":true,"waitForResponse":false,"caption":"Y-","name":"Button41","empty":false,"msg":"virtualId = fibaro:getSelfId();\ntotime = fibaro:get(virtualId,\"ui.totime.value\");\n\nlocal Y = string.sub(totime, 1,2);\nlocal M = string.sub(totime, 4,5);\nlocal D = string.sub(totime, 7,8);\n\nif tonumber(Y) == 0 then\n  Y = 99;\nelse\n  Y = tonumber(Y) - 1;\nend\n\nif string.len(Y) < 2 then Y = string.format(\"%s%s\", '0', Y); end\n\ntotime = string.format(\"%s/%s/%s\", Y, M, D);\n\nfibaro:call(virtualId,\"setProperty\",\"ui.totime.value\", totime);","buttonIcon":0,"favourite":false,"main":false},{"id":16,"lua":true,"waitForResponse":false,"caption":"M-","name":"Button42","empty":false,"msg":"virtualId = fibaro:getSelfId();\ntotime = fibaro:get(virtualId,\"ui.totime.value\");\n\nlocal Y = string.sub(totime, 1,2);\nlocal M = string.sub(totime, 4,5);\nlocal D = string.sub(totime, 7,8);\n\nif tonumber(M) == 1 then\n  M = 12\nelse\n  M = tonumber(M) - 1;\nend\n\nif string.len(M) < 2 then M = string.format(\"%s%s\", '0', M); end\n\ntotime = string.format(\"%s/%s/%s\", Y, M, D);\n\nfibaro:call(virtualId,\"setProperty\",\"ui.totime.value\", totime);","buttonIcon":0,"favourite":false,"main":false},{"id":17,"lua":true,"waitForResponse":false,"caption":"D-","name":"Button43","empty":false,"msg":"virtualId = fibaro:getSelfId();\ntotime = fibaro:get(virtualId,\"ui.totime.value\");\n\nlocal Y = string.sub(totime, 1,2);\nlocal M = string.sub(totime, 4,5);\nlocal D = string.sub(totime, 7,8);\n\nlocal maxd = { 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 }\nif Y%4 == 0 then maxd[2] = 29; end\n\nif tonumber(D) == 1 then\n  D = maxd[tonumber(M)]\nelse\n  D = tonumber(D) - 1;\nend\n\n\nif string.len(D) < 2 then D = string.format(\"%s%s\", '0', D); end\n\ntotime = string.format(\"%s/%s/%s\", Y, M, D);\n\nfibaro:call(virtualId,\"setProperty\",\"ui.totime.value\", totime);","buttonIcon":0,"favourite":false,"main":false}]}]},"actions":{"pressButton":1,"setSlider":2,"setProperty":2}}